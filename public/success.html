<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Payment Success</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            text-align: center;
            padding: 50px;
        }
        #result {
            margin-top: 20px;
        }
        .thank-you {
            font-size: 24px;
            color: green;
            margin-top: 20px;
        }
        .thank-you-header {
            font-size: 50px;
            color: green;
        }
    </style>
</head>
<body>
    <h1 class="thank-you-header">Payment Success</h1>
    <div id="result"></div>
    <div class="thank-you">Thank you for your order!</div>
    <script>
        const BASE_API = "http://huylong.io.vn/api_food/public/api/";
        
        function getQueryParams() {
            const params = {};
            window.location.search.replace(/[?&]+([^=&]+)=([^&]*)/gi, function(str, key, value) {
                params[key] = decodeURIComponent(value);
            });
            return params;
        }

        const params = getQueryParams();
        const arr = params.listProduct.slice(1, -1).split(",").map(Number);
        const note = (params.note === "no value") ? "" : params.note;
        const discountCode = params.discountCode;
        const customer_id = params.customer_id; 
        const quantity = parseInt(params.quantity, 10); 
        const payment = params.payment; 
        const totalPrice = params.totalPrice; 

        // document.addEventListener('DOMContentLoaded', () => {
        //     document.getElementById('result').innerHTML = `
        //         <p>Transaction ID: ${params.listProduct}</p>
        //         <p>Total Price: ${params.totalPrice}</p>
        //         <p>Quantity: ${params.quantity}</p>
        //     `;
        // });

        const orderData = {
            customer_id: customer_id,
            note: note,
            payment: payment,
            discount_id: discountCode
        };

        if (quantity === -1) {
            orderData.product_ids = arr;
        } else {
            orderData.product_id = arr[0];
            orderData.quantity = quantity;
        }

        const endpoint = quantity === -1 ? 'orders' : 'orders/single';

        fetch(BASE_API + endpoint, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify(orderData)
        })
        .then(response => response.json())
        .then(data => {
            console.log(data.message);
        })
        .catch(error => {
            console.error('Error:', error);
        });
    </script>
</body>
</html>
